import { request } from "../../request/index.js";
Page({
  data: {
    park_id: 0,
    money: null,
    partitionList:[],
    park: [
      {
        id: 0,
        name: '花花小区一区',
        item: [
          {id: '001',state: 1},
          {id: '002',state: 1},
          {id: '003',state: 0},
          {id: '004',state: 0},
          {id: '005',state: 0},
          {id: '006',state: 2},
          {id: '007',state: 2},
          {id: '008',state: 2},
          {id: '009',state: 0},
          {id: '010',state: 0},
          {id: '011',state: 0},
          {id: '012',state: 1},
          {id: '013',state: 0},
          {id: '014',state: 0},
          {id: '015',state: 0},
          {id: '016',state: 0},
          {id: '017',state: 0},
          {id: '018',state: 0},
          {id: '019',state: 0},
          {id: '020',state: 0},
          {id: '021',state: 0},
          {id: '022',state: 0},
          {id: '023',state: 0},
          {id: '024',state: 0},
          {id: '025',state: 0},
          {id: '026',state: 0},
          {id: '027',state: 0},
          {id: '028',state: 0},
          {id: '029',state: 2},
          {id: '030',state: 2},
          {id: '031',state: 2},
          {id: '032',state: 0},
          {id: '033',state: 0},
          {id: '034',state: 0},
          {id: '035',state: 0},
          {id: '036',state: 0},
          {id: '037',state: 0},
          {id: '038',state: 1},
          {id: '039',state: 1},
          {id: '040',state: 1},
          {id: '041',state: 1},
          {id: '042',state: 0},
          {id: '043',state: 0},
          {id: '044',state: 0},
          {id: '045',state: 0},
          {id: '046',state: 1},
          {id: '047',state: 1},
          {id: '048',state: 0},
          {id: '049',state: 0},
          {id: '050',state: 0},
          {id: '051',state: 0},
          {id: '052',state: 0},
          {id: '053',state: 0},
          {id: '054',state: 0},
          {id: '055',state: 0},
          {id: '056',state: 0},
          {id: '057',state: 0},
          {id: '058',state: 2},
          {id: '059',state: 2},
          {id: '060',state: 2},
          {id: '061',state: 0},
          {id: '062',state: 0},
          {id: '063',state: 0},
          {id: '064',state: 0},
          {id: '065',state: 0},
          {id: '066',state: 0},
          {id: '067',state: 0},
          {id: '068',state: 0},
          {id: '069',state: 1},
          {id: '070',state: 1},
          {id: '071',state: 1},
          {id: '072',state: 0},
          {id: '073',state: 0},
          {id: '074',state: 0},
          {id: '075',state: 0},
          {id: '076',state: 0},
          {id: '077',state: 0},
          {id: '078',state: 0},
          {id: '079',state: 0},
          {id: '080',state: 0},
          {id: '081',state: 0},
          {id: '082',state: 0},
          {id: '083',state: 0},
          {id: '084',state: 0},
          {id: '085',state: 2},
          {id: '086',state: 2},
          {id: '087',state: 2},
          {id: '088',state: 0},
          {id: '089',state: 0},
          {id: '090',state: 0},
          {id: '091',state: 2},
          {id: '092',state: 0},
          {id: '093',state: 1},
          {id: '094',state: 0},
          {id: '095',state: 2},
          {id: '096',state: 0},
          {id: '097',state: 1},
          {id: '098',state: 1},
          {id: '099',state: 1},
          {id: '100',state: 0},
        ]
      },
      {
        id: 1,
        name: '花花小区二区',
        item: [
          {id: '001',state: 1},
          {id: '002',state: 1},
          {id: '003',state: 0},
          {id: '004',state: 0},
          {id: '005',state: 0},
          {id: '006',state: 2},
          {id: '007',state: 2},
          {id: '008',state: 2},
          {id: '009',state: 0},
          {id: '010',state: 0},
          {id: '011',state: 0},
          {id: '012',state: 1},
          {id: '013',state: 0},
          {id: '014',state: 0},
          {id: '015',state: 0},
          {id: '016',state: 0},
          {id: '017',state: 0},
          {id: '018',state: 0},
          {id: '019',state: 0},
          {id: '020',state: 0},
          {id: '021',state: 0},
          {id: '022',state: 0},
          {id: '023',state: 0},
          {id: '024',state: 0},
          {id: '025',state: 0},
          {id: '026',state: 0},
          {id: '027',state: 0},
          {id: '028',state: 0},
          {id: '029',state: 2},
          {id: '030',state: 2},
          {id: '031',state: 2},
          {id: '032',state: 0},
          {id: '033',state: 0},
          {id: '034',state: 0},
          {id: '035',state: 0},
          {id: '036',state: 0},
          {id: '037',state: 0},
          {id: '038',state: 1},
          {id: '039',state: 1},
          {id: '040',state: 1},
          {id: '041',state: 1},
          {id: '042',state: 0},
          {id: '043',state: 0},
          {id: '044',state: 0},
          {id: '045',state: 0},
          {id: '046',state: 1},
          {id: '047',state: 1},
          {id: '048',state: 0},
          {id: '049',state: 0},
          {id: '050',state: 0},
          {id: '051',state: 0},
          {id: '052',state: 0},
          {id: '053',state: 0},
          {id: '054',state: 0},
          {id: '055',state: 0},
          {id: '056',state: 0},
          {id: '057',state: 0},
          {id: '058',state: 2},
          {id: '059',state: 2},
          {id: '060',state: 2},
          {id: '061',state: 0},
          {id: '062',state: 0},
          {id: '063',state: 0},
          {id: '064',state: 0},
          {id: '065',state: 0},
          {id: '066',state: 0},
          {id: '067',state: 0},
          {id: '068',state: 0},
          {id: '069',state: 1},
          {id: '070',state: 1},
          {id: '071',state: 1},
          {id: '072',state: 0},
          {id: '073',state: 0},
          {id: '074',state: 0},
          {id: '075',state: 0},
          {id: '076',state: 0},
          {id: '077',state: 0},
          {id: '078',state: 0},
          {id: '079',state: 0},
          {id: '080',state: 0},
          {id: '081',state: 0},
          {id: '082',state: 0},
          {id: '083',state: 0},
          {id: '084',state: 0},
          {id: '085',state: 2},
          {id: '086',state: 2},
          {id: '087',state: 2},
          {id: '088',state: 0},
          {id: '089',state: 0},
          {id: '090',state: 0},
          {id: '091',state: 2},
          {id: '092',state: 0},
          {id: '093',state: 1},
          {id: '094',state: 0},
          {id: '095',state: 2},
          {id: '096',state: 0},
          {id: '097',state: 1},
          {id: '098',state: 1},
          {id: '099',state: 1},
          {id: '100',state: 0},
        ]
      },
      {
        id: 2,
        name: '花花小区三区',
        item: [
          {id: '001',state: 1},
          {id: '002',state: 1},
          {id: '003',state: 0},
          {id: '004',state: 0},
          {id: '005',state: 0},
          {id: '006',state: 2},
          {id: '007',state: 2},
          {id: '008',state: 2},
          {id: '009',state: 0},
          {id: '010',state: 0},
          {id: '011',state: 0},
          {id: '012',state: 1},
          {id: '013',state: 0},
          {id: '014',state: 0},
          {id: '015',state: 0},
          {id: '016',state: 0},
          {id: '017',state: 0},
          {id: '018',state: 0},
          {id: '019',state: 0},
          {id: '020',state: 0},
          {id: '021',state: 0},
          {id: '022',state: 0},
          {id: '023',state: 0},
          {id: '024',state: 0},
          {id: '025',state: 0},
          {id: '026',state: 0},
          {id: '027',state: 0},
          {id: '028',state: 0},
          {id: '029',state: 2},
          {id: '030',state: 2},
          {id: '031',state: 2},
          {id: '032',state: 0},
          {id: '033',state: 0},
          {id: '034',state: 0},
          {id: '035',state: 0},
          {id: '036',state: 0},
          {id: '037',state: 0},
          {id: '038',state: 1},
          {id: '039',state: 1},
          {id: '040',state: 1},
          {id: '041',state: 1},
          {id: '042',state: 0},
          {id: '043',state: 0},
          {id: '044',state: 0},
          {id: '045',state: 0},
          {id: '046',state: 1},
          {id: '047',state: 1},
          {id: '048',state: 0},
          {id: '049',state: 0},
          {id: '050',state: 0},
          {id: '051',state: 0},
          {id: '052',state: 0},
          {id: '053',state: 0},
          {id: '054',state: 0},
          {id: '055',state: 0},
          {id: '056',state: 0},
          {id: '057',state: 0},
          {id: '058',state: 2},
          {id: '059',state: 2},
          {id: '060',state: 2},
          {id: '061',state: 0},
          {id: '062',state: 0},
          {id: '063',state: 0},
          {id: '064',state: 0},
          {id: '065',state: 0},
          {id: '066',state: 0},
          {id: '067',state: 0},
          {id: '068',state: 0},
          {id: '069',state: 1},
          {id: '070',state: 1},
          {id: '071',state: 1},
          {id: '072',state: 0},
          {id: '073',state: 0},
          {id: '074',state: 0},
          {id: '075',state: 0},
          {id: '076',state: 0},
          {id: '077',state: 0},
          {id: '078',state: 0},
          {id: '079',state: 0},
          {id: '080',state: 0},
          {id: '081',state: 0},
          {id: '082',state: 0},
          {id: '083',state: 0},
          {id: '084',state: 0},
          {id: '085',state: 2},
          {id: '086',state: 2},
          {id: '087',state: 2},
          {id: '088',state: 0},
          {id: '089',state: 0},
          {id: '090',state: 0},
          {id: '091',state: 2},
          {id: '092',state: 0},
          {id: '093',state: 1},
          {id: '094',state: 0},
          {id: '095',state: 2},
          {id: '096',state: 0},
          {id: '097',state: 1},
          {id: '098',state: 1},
          {id: '099',state: 1},
          {id: '100',state: 0},
        ]
      },
      {
        id: 3,
        name: '花花小区四区',
        item: [
          {id: '001',state: 1},
          {id: '002',state: 1},
          {id: '003',state: 0},
          {id: '004',state: 0},
          {id: '005',state: 0},
          {id: '006',state: 2},
          {id: '007',state: 2},
          {id: '008',state: 2},
          {id: '009',state: 0},
          {id: '010',state: 0},
          {id: '011',state: 0},
          {id: '012',state: 1},
          {id: '013',state: 0},
          {id: '014',state: 0},
          {id: '015',state: 0},
          {id: '016',state: 0},
          {id: '017',state: 0},
          {id: '018',state: 0},
          {id: '019',state: 0},
          {id: '020',state: 0},
          {id: '021',state: 0},
          {id: '022',state: 0},
          {id: '023',state: 0},
          {id: '024',state: 0},
          {id: '025',state: 0},
          {id: '026',state: 0},
          {id: '027',state: 0},
          {id: '028',state: 0},
          {id: '029',state: 2},
          {id: '030',state: 2},
          {id: '031',state: 2},
          {id: '032',state: 0},
          {id: '033',state: 0},
          {id: '034',state: 0},
          {id: '035',state: 0},
          {id: '036',state: 0},
          {id: '037',state: 0},
          {id: '038',state: 1},
          {id: '039',state: 1},
          {id: '040',state: 1},
          {id: '041',state: 1},
          {id: '042',state: 0},
          {id: '043',state: 0},
          {id: '044',state: 0},
          {id: '045',state: 0},
          {id: '046',state: 1},
          {id: '047',state: 1},
          {id: '048',state: 0},
          {id: '049',state: 0},
          {id: '050',state: 0},
          {id: '051',state: 0},
          {id: '052',state: 0},
          {id: '053',state: 0},
          {id: '054',state: 0},
          {id: '055',state: 0},
          {id: '056',state: 0},
          {id: '057',state: 0},
          {id: '058',state: 2},
          {id: '059',state: 2},
          {id: '060',state: 2},
          {id: '061',state: 0},
          {id: '062',state: 0},
          {id: '063',state: 0},
          {id: '064',state: 0},
          {id: '065',state: 0},
          {id: '066',state: 0},
          {id: '067',state: 0},
          {id: '068',state: 0},
          {id: '069',state: 1},
          {id: '070',state: 1},
          {id: '071',state: 1},
          {id: '072',state: 0},
          {id: '073',state: 0},
          {id: '074',state: 0},
          {id: '075',state: 0},
          {id: '076',state: 0},
          {id: '077',state: 0},
          {id: '078',state: 0},
          {id: '079',state: 0},
          {id: '080',state: 0},
          {id: '081',state: 0},
          {id: '082',state: 0},
          {id: '083',state: 0},
          {id: '084',state: 0},
          {id: '085',state: 2},
          {id: '086',state: 2},
          {id: '087',state: 2},
          {id: '088',state: 0},
          {id: '089',state: 0},
          {id: '090',state: 0},
          {id: '091',state: 2},
          {id: '092',state: 0},
          {id: '093',state: 1},
          {id: '094',state: 0},
          {id: '095',state: 2},
          {id: '096',state: 0},
          {id: '097',state: 1},
          {id: '098',state: 1},
          {id: '099',state: 1},
          {id: '100',state: 0},
        ]
      }
    ],
    currentParkId: 0,
    currentParkName: null,
    onlySeeUncheck: false,
    chooseItemId: null,
    chooseCode: null,
    currentParkList:{}
  },
  async onShow(){
    let pages = getCurrentPages();
    let currentPage = pages[pages.length - 1];
    let options = currentPage.options;
    const { park_id,money } = options;
    this.setData({
      park_id,
      money
    })
    await this.getParkPartitionList();
    this.setData({
      currentParkId: this.data.partitionList[0].id,
      currentParkName: this.data.partitionList[0].name
    })
    this.getCurrentParkList();
  },
  parkClick(e){
    this.setData({
      currentParkId: e.currentTarget.dataset.currentid,
      currentParkName: e.currentTarget.dataset.currentname,
      chooseItemId: null,
      chooseCode: null
    })
    this.getCurrentParkList();
  },
  checkboxChange(){
    this.setData({
      onlySeeUncheck: !this.data.onlySeeUncheck
    })
  },
  itemClick(e){
    // console.log(this.data.currentParkList);
    // console.log(e.currentTarget.dataset);
    // console.log(this.data.currentParkList[parseInt(e.currentTarget.dataset.code)-1]);
    if(this.data.currentParkList[parseInt(e.currentTarget.dataset.code)-1].state==0){
      this.setData({
        chooseItemId: e.currentTarget.dataset.itemid,
        chooseCode: e.currentTarget.dataset.code
      }) 
    }
  },
  async getParkPartitionList(){
    const res = await request({url:"/v1/partition/list/"+this.data.park_id,method:"post"});
    this.setData({
      partitionList: res
    })
    console.log(res);
  },
  async getCurrentParkList(){
    const res = await request({url:"/v1/parking/list/"+this.data.currentParkId});
    this.setData({
      currentParkList: res
    })
    console.log(res);
  },
  pay(){
    if(this.data.chooseItemId==null){
      wx.showToast({
        title: '请先选择车位',
        icon: 'error',
        image: '',
        duration: 1500,
        mask: true,
        success: (result) => {
          
        },
        fail: () => {},
        complete: () => {}
      });
       return; 
    }else{
      wx.navigateTo({
        url: '/pages/pay_front/index?id='+this.data.chooseItemId+'&code='+this.data.chooseCode+'&'+'&money='+this.data.money+'&parkName='+this.data.currentParkName
      });
        
    }
  }
})

